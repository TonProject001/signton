<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#0f172a" />
    <title>SignTon v.3 Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Global Error Handler
      window.onerror = function(msg, url, line, col, error) {
        const log = document.getElementById('error-log');
        const loader = document.getElementById('loading-indicator');
        if (log) {
          log.style.display = 'block';
          if(loader) loader.style.display = 'none';
          log.innerHTML += `<div class="mb-2 p-2 border-b border-red-500/30"><strong>Error:</strong> ${msg}<br/><span class="text-xs opacity-75">${url}:${line}</span></div>`;
        }
        return false;
      };

      window.onunhandledrejection = function(event) {
        const log = document.getElementById('error-log');
        const loader = document.getElementById('loading-indicator');
        if (log) {
          log.style.display = 'block';
          if(loader) loader.style.display = 'none';
          log.innerHTML += `<div class="mb-2 p-2 border-b border-red-500/30"><strong>Promise Error:</strong> ${event.reason}</div>`;
        }
      };
    </script>
    <style>
      .no-scrollbar::-webkit-scrollbar { display: none; }
      .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
      @keyframes fade-in { from { opacity: 0; } to { opacity: 1; } }
      .animate-fade-in { animation: fade-in 0.5s ease-in-out; }
      .loader {
        border: 4px solid #1e293b;
        border-radius: 50%;
        border-top: 4px solid #3b82f6;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
    <!-- 
      FIXED IMPORT MAP:
      1. Removed React 19 references causing conflicts.
      2. Added 'target=es2019' to ensure compatibility with older Android WebViews.
      3. Kept Google CDN for Firebase for stability.
    -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0?target=es2019",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client?target=es2019&deps=react@18.2.0",
    "react-dom": "https://esm.sh/react-dom@18.2.0?target=es2019&deps=react@18.2.0",
    "lucide-react": "https://esm.sh/lucide-react@0.263.1?target=es2019&deps=react@18.2.0",
    "@google/genai": "https://esm.sh/@google/genai@0.1.1?target=es2019",
    "react-router-dom": "https://esm.sh/react-router-dom@6.22.3?target=es2019&deps=react@18.2.0,react-dom@18.2.0",
    "firebase/app": "https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js",
    "firebase/firestore": "https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "firebase/": "https://aistudiocdn.com/firebase@^12.6.0/"
  }
}
</script>
</head>
  <body class="bg-slate-950 text-slate-100 antialiased overflow-hidden">
    <!-- Error Logger -->
    <div id="error-log" class="fixed top-0 left-0 w-full h-full bg-red-950/95 text-white p-6 z-[9999] hidden font-mono text-sm overflow-auto">
      <h3 class="font-bold text-xl border-b border-red-500 pb-2 mb-4 text-red-200">System Error Log</h3>
      <p class="text-xs text-slate-300 mb-4">Please take a photo of this screen and send to support.</p>
    </div>

    <div id="root" class="h-screen w-screen">
       <div id="loading-indicator" class="h-full w-full flex flex-col items-center justify-center space-y-4">
          <div class="loader"></div>
          <div class="text-center">
            <p id="loading-text" class="text-slate-400 text-sm font-mono animate-pulse">Initializing System...</p>
            <p id="loading-subtext" class="text-slate-600 text-xs mt-2">Loading Modules...</p>
          </div>
       </div>
    </div>

    <!-- Timeout Detection Script -->
    <script>
      console.log("Browser Start Loading...");
      setTimeout(() => {
        const root = document.getElementById('root');
        if (document.getElementById('loading-indicator')) {
          const text = document.getElementById('loading-text');
          const sub = document.getElementById('loading-subtext');
          if (text) {
             text.innerText = "System Timeout";
             text.className = "text-yellow-500 font-bold text-lg";
          }
          if (sub) {
             sub.innerHTML = "Cannot start application.<br/>1. Check Internet<br/>2. Device might be too old<br/>3. Try refreshing";
             sub.className = "text-slate-400 text-sm mt-2";
          }
          console.error("Timeout reached: App did not mount.");
        }
      }, 20000); // Increased to 20 seconds
    </script>
    <script type="module" src="./index.tsx"></script>
  </body>
</html>
